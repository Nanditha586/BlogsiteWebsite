{% load static %}
<html>
<head>
    <title>Followers of {{ author_username }}</title>
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <!-- Full jQuery (not slim) -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body class="bg-light">
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mt-4">
    <h3>Followers of {{ author_username }}</h3>
    <a href="{% url 'profilepage' %}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> Back
    </a>
</div>
<hr>
    {% if followers %}
        <ul class="list-group">
            {% for follower in followers %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <a href="{%url 'aboutauthor' follower.username%}">
                    <img src="{{ follower.profilephoto }}" 
                         style="width:50px; height:50px; border-radius:50%; object-fit:cover; margin-right:15px;">
                    <strong style="color: black;">{{ follower.username }}</strong>
                    </a>
                </div>
                {% if request.session.email and follower.username != request.session.username %}
                                        <button 
                                            type="button"
                                            class="btn btn-sm follow-btn {% if follower.is_following %}btn-outline-primary{% else %}btn-primary{% endif %}"
                                            data-username="{{ follower.username }}">
                                            {% if follower.is_following %}Following{% else %}Follow{% endif %}
                                        </button>
                                    {% endif %}
            </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-muted">No followers yet.</p>
    {% endif %}
</div>
    <script>
    $(document).on('click', '.follow-btn', function(){
        let button = $(this);
        let username = button.data('username');

        $.ajax({
            url: "{% url 'toggle_follow' %}",
            method: "POST",
            data: {
                'follow_author': username,
                'csrfmiddlewaretoken': '{{ csrf_token }}'
            },
            success: function(response){
                if(response.status === "followed"){
                    button.removeClass('btn-primary')
                          .addClass('btn-outline-primary')
                          .text("Following");
                } else if(response.status === "unfollowed"){
                    button.removeClass('btn-outline-primary')
                          .addClass('btn-primary')
                          .text("Follow");
                }
            }
        });
    });
    </script>
</body>
</html>
